#!/usr/bin/env bash

set -e

unset GIT_DIR

# IS_PHOENIX set in compile script and exported for this
if [ "$IS_PHOENIX" = "true" ]; then
  mix help | grep -E 'mix phx.server' > /dev/null
  RESULT=$?
  if [ $RESULT -eq 0 ]; then
    MIX_CMD="phx.server"
  else
    MIX_CMD="phoenix.server"
  fi
else
  MIX_CMD="run --no-halt"
fi

cat <<EOF
---
addons:
  []
default_process_types:
  web: elixir --name \$MY_NODE_NAME --cookie \$MY_COOKIE -S mix $MIX_CMD
EOF
